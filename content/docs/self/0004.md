---
title: "小技巧备忘"
date: 2020-01-13T19:20:35+08:00
draft: true
categories: ["杂记"]
tags: ["备忘","知乎","技巧"]
---


## 1 本地md+LaTex如何完美发布到知乎？

答：知乎编辑器提供了md上传，还提供了`https://www.zhihu.com/equation?tex=...`接口，并且支持贴图自动上传。　因此完全支持本地Markdown+LaTex完美发布到知乎，具体步骤如下：

- 用本地Markdown编辑器放心写作。【我使用`Typora`】
- 将本地图片换成网上图片，我个人的做法是先发布到`gitbook`，比如我的[`https://joistwang.gitbook.io/notes/`](https://joistwang.gitbook.io/notes/)。然后复制图片链接，替换原本地图片链接，图片数量一般不多，手工替换也不麻烦。
- 将LaTex代码用`https://www.zhihu.com/equation?tex=...`替换。首先得有支持正则表达全文置换编辑器【我使用`Visual Studio Code`】，然后将　`\$\$(\n*)\s*(.*?)(\n*)\s*\$\$`　替换成　`$1<img src="https://www.zhihu.com/equation?tex=$2" alt="$2" class="ee_img tr_noresize" eeimg="1">$3`。 当然前面这个正则表达式的形式要以实际为准。
- 最后，保存文件，然后打开知乎编辑器，上传md文件，简单调整后，发布，完工。

<!--more-->

## 2 Git如何永久删除文件(包括历史记录)

首先，可参考 github 的帮助:

https://help.github.com/articles/remove-sensitive-data

**第一步**：从你的资料库中清除文件

以Windows下为例(Linux类似), 打开项目的Git Bash,使用命令:

```shell
$ git filter-branch --force --index-filter 'git rm --cached --ignore-unmatch <你要删除的文件的相对路径>' --prune-empty --tag-name-filter cat -- --all

$ git filter-branch --force --index-filter 'git rm --cached -r --ignore-unmatch <你要删除的文件夹的相对路径>' --prune-empty --tag-name-filter cat -- --all

## 相对路径可以用通配符
## 这里的文件或文件夹，都不能以 '/' 开头，否则文件或文件夹会被认为是从 git 的安装目录开始。
```



如果你看到类似下面这样的, 就说明删除成功了:

```shell
Rewrite 48dc599c80e20527ed902928085e7861e6b3cbe6 (266/266)
# Ref 'refs/heads/master' was rewritten
```

**第二步**: 推送我们修改后的repo

以强制覆盖的方式推送你的repo, 命令如下:

```shell
$ git push origin master --force --all
$ git push origin master --force --tags
```

**第三步**: 清理和回收空间

虽然上面我们已经删除了文件, 但是我们的repo里面仍然保留了这些objects, 等待垃圾回收(GC), 所以我们要用命令彻底清除它, 并收回空间.

```shell
$ rm -rf .git/refs/original/

$ git reflog expire --expire=now --all

$ git gc --prune=now


Counting objects: 2437, done.
# Delta compression using up to 4 threads.
# Compressing objects: 100% (1378/1378), done.
# Writing objects: 100% (2437/2437), done.
# Total 2437 (delta 1461), reused 1802 (delta 1048)


$ git gc --aggressive --prune=now


Counting objects: 2437, done.
# Delta compression using up to 4 threads.
# Compressing objects: 100% (2426/2426), done.
# Writing objects: 100% (2437/2437), done.
# Total 2437 (delta 1483), reused 0 (delta 0)
```



## 以后遇到小问题继续添加...



